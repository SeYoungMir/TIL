# 5. 빅데이터 적재 II - 실시간 로그/분석 적재
## 2. 빅데이터 실시간 적재에 활용하는 기술
### 1. HBase - 이어서
- HBase 아키텍처
  - 하둡의 HDFS를 기반으로 설치 및 구성된다는 특징
  - 분산 데이터베이스 아키텍처를 채택, HDFS의 가용성과 확장성을 그대로 물려받았음
  - 클라이언트가 HBase에 데이터를 저장(Put)
    - 클라이언트가 HBase에 테이블에 특정 데이터를 저장하기 전 주키퍼를 통해 HTable의 기본 정보와 해당 HRegion의 위치 정보를 알아냄
    - 해당 정보를 기반으로 클라이언트가 직접 HRegionServer로 연결, HRegion의 Memory 영역인 MemStore에 데이터를 저장. 이 때 MemStore에 저장된 데이터는 특정 시점이 되면 HFile로 HDFS에 플러시(Flush)되고, HFile은 HRegion의 상황에 따라 최적의 HFile로 재구성되는 작업이 이뤄짐. 이러한 플러시 과정들을 HBase에서 Minor/Major Compaction이라 함
  - Hbase에서 특정 데이터를 가져오는 과정은 우선 주키퍼를 통해 로우키(RowKey)에 해당하는 데이터의 위치 정보를 알아내고 해당 HRegionServer의 Memory 영역인 MemStore에서 데이터를 가져옴으로써 디스크 I/O를 최소화하면서 빠른 응답 속도를 보장. 데이터가 MemStore에서 플러시되어 플러시되어 존재하지 않으면 HFile 영역으로 이동해 데이터를 찾게 되는데, 이 때 HBase와 HDFS 사이의 모든 데이터 스트림 라인들은 항상 열려있으므로 레이턴시 발생 X.
- HBase 아키텍처
  - 주키퍼
    - 클라이언트
    - HMaster
      - HRegionServer 1/2
        - HRegion 1 / 2 / 3/ 2-1
          - MemStore
          - HFile
    - 하둡 DataNode 1, 2
- HBase 활용 방안
  - 수집 영역 개발에서 플럼을 이용해 수집한 스마트카 운전자의 운행 정보를 카프카까지 전송했었음.
  - 카프카에 저장된 데이터를 스톰이 받아서 HBase의 테이블에 모두 적재, HBase에 저장된 스마트카 운전자의 운행 정보를 특정 조건에 따라 필터링해서 신속하게 조회, 하이브 핸들러를 이용해 HBase에 저장된 데이터와 하이브 데이터를 동시 활용
  - 운전자 운행 로그
    - 400KB/1초
  - 플럼
  - 카프카
  - 스톰
    - HBase
      - HRegionServer1/2/3
        - DriverInfo 1~6
      - 스마트카 운전자의 실시간 운행정보 적재
      - 운전자의 운행 정보를 빠르게 검색 및 조회
