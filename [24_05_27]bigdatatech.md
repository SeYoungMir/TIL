# 8. 크롤러 유지보수와 운용
## 2. 다중 실행 방지하기
### 1. 동일 처리 다중 실행 대책- 이어서
- if [ $? -eq 0];부분에서는 ps 명령어 실행으로 구한 프로세스 ID 중에 $PID를 가진 프로세스가 있는지 판단. 명령어 실행 후의 종료 상태는 $? 기번으로 참조, -eq 조건 연산자로 0인지 확인
- 종료 상태란 명령어 실행 결과가 정상인지 이상인지 나타내는 값. 일바적으로 0이라면 정상 종료이며 0 이외의 값이라면 이상 종료를 나타냄. 현재 스크립트는 프로세스가 종료될 경우 rm 명령어의 처리로 프로세스 ID가 들어있는 파일을 삭제하게 되어 있음
- 만약 프로세스 ID가 적혀 있는 파일이 존재하고, $PIDFILE에 해당 프로세스 ID가 있다면 echo 명령어로 '이미 실행 중.' 메시지를 출력, exit로 스크립트의 실행 종료
- exit 명령어의 매개 변수는 종료 상태. 현재 코드에서는 1로 지정중이므로 이상 종료를 나타냄
- else 부분은 프로세스 ID가 적혀있는 파일이 존재하고, 해당 파일 내부에 지정한 프로세스 ID가 있는 경우. 어떠한 문제가 발생해서 rm 명령어의 처리가 정상적으로 이뤄지지 않으면 이곳으로 들어옴.
- 이는 특이한 문제로 인해 다른 프로세스 ID로 해당 프로세스가 실행되고 있는 경우일 수 있음. (다른 특이한 상황일 수도 있음)따라서 사용자에게 어떤 문제인지 출력, 스크립ㅌ트 실행을 그냥 종료.
- echo $$ 의 $$는 자신을 실행하고 있는 프로세스의 ID를 얻을 때 사용하는 기법. 이를 echo 명령어로 출력, $PIDFILE에 리다이렉트, 파일에도 내용 출력.
- 다음 줄에서는 $(cat $PIDFILE)로 자기 자신의 프로세스 ID를 메시지에 포함시켜서 echo 명령어로 출력
- main_command 부분은 메인 처리가 되는 명령어 실행.
- rm 부분처럼 위의 명령어 실행 종료 시 $PIDFILE을 제거.
- bash 명령어와 관련된 자세한 내용은 다음 문서 참고
  - Bash Reference Manual[[URL](https://www.gnu.org/software/bash/manual/bash.html)]