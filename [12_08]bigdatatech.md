# 5. 빅데이터 적재 II - 실시간 로그/분석 적재
## 4. 실시간 적재 파일럿 실행 2단계- 실시간 적재 환경 구성
- 3개의 소프트웨어 추가 설치
- CM을 이용해 HBase를 Server 01~03에 있는 3대의 데이터노드에 설치
- 그 밖에 레디스와 스톰은 별도의 패키지로 설치
- HBase 설치
- 레디스 설치
- 스톰 설치
## 5. 실시간 적재 파일럿 실행 3단계 -실시간 적재 기능 구현
- 실시간 적재 기능 구현은 스톰의 Spout와 Bolt의 프로그램 구현 단계에 해당
- 운전자의 운행 정보가 실시간으로 카프카에 적재, 스톰의 Spout가 읽어서 Bolt로 전달
- 실시간 처리와 적재를 위한 스톰 Topology는 안의 5개 컴포넌트는  모두 자바 프로그램, 실시간 적재 기능을 구현
- 실시간 적재에 사용되는 Spout과 Bolt의 핵심 소스 위주로 설명, 레디스에 적재된 데이터를 실시간으로 가져오는 클라이언트 애플리케이션도 살펴봄. 관련 자바 프로그램들을 독자들이 직접 배포/설치해 파일럿 프로젝트의 실시간 적재 기능들을 테스트함 
### 1. 카프카 Spout 기능 구현
- 스톰 Spout의 기본 기능은 외부 시스템과의 연동을 통해 스톰의 Topology로 데이터를 가져오는 것
- 파일럿 프로젝트에서는 카프카에 적재된 데이터를 가져오기 위해 카프카-Spout을 사용
- 카프카 Spout는 카프카로부터 수신받은 데이터를 두 개의 Bolt(Split/Esper)에 라우팅
### 2. Split Bolt 기능 구현
- Split Bolt는 카프카-Spout으로부터 전달받은 메시지를 HBase의 칼럼 필드 단위로 분리하기 위한 작업 수행
### 3. HBase Bolt 기능 구현
- HBase Bolt는 스마트카 운전자의 모든 운행 데이터를 최종적으로 적재하는 기능을 수행, 앞서 Split Bolt가 분리한 필드명을 HBase의 테이블의 칼럼명과 일치시켜 칼럼 단위로 저장
- HBase Bolt도 HBase의 데이터를 적재하기 위해 HBase에 연결된 주키퍼의 연결 정보가 필ㅇ, 저장하고자 하는 테이블의 로우키와 칼럼 패밀리 정보도 알고 있어야 함.
### 4. 에스퍼 Bolt 기능 구현
- 에스퍼 Bolt는 스마트카 운전자 가운데 과속을 하는 운전자를 찾아 이벤트를 발생시키는 기능
- 에스퍼 Bolt의 이벤트 구현은 에스퍼 CEP 엔진을 이용하며, 이 때 EPL 쿼리로 30초 Window-Time 기준으로 평균 속도 80Km/h를 초과한 운전자를 찾기 위한 룰을 작성함, 그리고 해당 차량번호와 평균 속도를 초과한 시점의 시간 정보를 다음 Bolt에 전달.
- 에스퍼 EPL 동적 로딩
  - 에스퍼의 룰인 EPL을 EsperBolt.java에 직접 작성하면 업무 룰이 바뀔때마다 빈번하게 수정되므로 직접 하드코딩하는 것은 좋은 방법이 아님. 실제 환경에서는 EPL 쿼리를 별도의 공유 저장소를 구축해 통합 보관하고, 스톰 Bolt 같은 프로그램이 이 저장소로부터 EPL 쿼리를 주기적으로 로딩하거나 역으로 스톰의 Bolt로 푸시하는 아키텍처를 구성. 
  - EPL의 공유 저장소를 카프카 또는 레디스로 만들고, 비즈니스 요건 변경으로 EPL 수정이 발생하면 스톰의 Bolt가 공유 저장소로부터 EPL을 수신받아 동적으로 교체하는 방식으로 EPL 쿼리를 관리