# 5. 빅데이터 적재 II - 실시간 로그/분석 적재
## 3. 실시간 적재 파일럿 실행 1단계- 실시간 적재 아키텍처
### 1.실시간 적재 요구사항
  - 요구사항 1: 차량의 다양한 장치로부터 발생하는 로그 파일을 수집해서 기능별 상태를 점검함
  - 요구사항 2: 운전자의 운행 정보가 담긴 로그를 실시간으로 수집해서 주행 패턴을 분석
- 요구사항 2는 실시간 분석 결과를 적재하기 위한 요건으로 이를 좀 더 구체화하고, 적용할 기술 검토와 해결 방안들을 알아봄
### 2. 요구사항 구체화 및 분석
<table>
    <tr>
        <td>실시간 적재 요구사항 구체화</td>
        <td>분석 및 해결 방안</td>
    </tr>
    <tr>
        <td>1. 1초 간격으로 발생하는 100명의 운행 정보(운행 정보 1건:약 4KN)는 손실 없이 적재해야 함</td>
        <td>카프카와 스톰을 이용해 수집한 데이터에 대해 분산 처리 및 무결성을 보장, 분산 처리가 완료된 데이터는 HBase에 적재</td>
    </tr>
    <tr>
        <td>2.적재한 운행 정보를 대상으로 조건 검색이 가능해야 하며, 필요 시 수정도 가능해야 함</td>
        <td>HBase의 테이블에 적재된 데이터는 스캔 조건으로 검색하며, 저장(Put) 기능을 이용해 기적재한 데이터에 대해 칼럼 기반으로 수정</td>
    </tr>
    <tr>
        <td>3. 운전자의 운행 정보 중 30초를 기준을 평균 속도가 80Km/h를 초과한 정보는 분리 적재함</td>
        <td>에스퍼의 EPL에서 사용자별로 운행 정보를 그루핑하고, 30초의 윈도우 타임(Window Time) 조건으로 평균 시속 집계 및 임계차별 이벤트를 정의</td>
    </tr>
    <tr>
        <td>4. 과속한 차량을 분리 적재하기 위한 조건은 별도의 룰로 정의하고 쉽게 수정할 수 있어야 함.</td>
        <td>과속 기준을 80Km/h에서 100Km/h로 변경해야 할 경우 EPL의 평균 속도를 체크하는 조건값만 수정</td>
    </tr>
    <tr>
        <td>5.분리 적재한 데이터는 외부 애플리케이션이 빠르게 접근하고 조회할 수 있게 해야 함</td>
        <td>실시간 이벤트로 감지된 데이터는 인메모리 기반 저장소인 레디스의 적재해서 외부 애플리케이션에서 빠르게 조회</td>
    </tr>
    <tr>
        <td>6.레디스에 적재한 데이터는 저장소의 공간을 효율적으로 사용하기 위해 1주일이 경과하면 영구적으로 삭제함</td>
        <td>레디스 클라이언트 라이브러리인 제디스(Jedis)클라이언트를 이용해 데이터 적재 시 만료(Expire) 시간을 설정해 자동으로 영구 삭제 처리</td>
    </tr>
</table>