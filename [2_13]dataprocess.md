#### 데이터프레임 병합
- Pandas는 두 개 이상의 데이터 프레임을 하나로 합치는 병합(merge)이나 연결(concate)를 지원한다
#### merge 명령을 사용한 데이터 프레임 병합
- merge
  - 두 개의 데이터 프레임의 공통 열이나 인덱스를 기준으로 두개의 데이터 프레임을 합친다.
  - 이 때, 기준이 되는 열 데이터를 key라고 부른다.
#### 형식
- df.merge(df1): 두 df를 병합시켜준다
- 기본은 inner join:양 쪽에 동일하게 존재하는 키만 표시
- Key: 기준 열을 의미
  - 실제 데이터 필드거나 행 인덱스일 수 있다.
- 병합방식
  - inner join : 양쪽 df에서 모두 키가 존재하는 data만 표시
  - outer join : 한 쪽에만 키가 존재하면 data를 표시
  - 병합 방식을 설정:how = inner(생략 가능),how = outer
- how= inner/outer/left/right
  - how = left: 왼쪽 df에 있는 모든 키의 데이터를 표시
  - how = right: 오른쪽 df에 있는 모든 키의 데이터를 표시
- 동일한 키 값이 있는 경우
  - 키 값이 같은 데이터가 여러개 있는 경우에는 있을 수 있는 모든 경우의 수를 따져서 조합을 만들어 낸다.
#### df1과 df2를 병합
- 위 데이터에서 키 값 setosa에 대해
  - df1에는 1.4와 1.3 2개의 데이터가 있고
  - df2에는 0.4라는 1개의 데이터가 있으므로
  - 병합 데이터에는 setosa가 (1.4,0.4)(1.3,0.4)의 2 경우가 표현된다.
- 키값 virginica의 경우에는 df1에 2개 df2에 2개의 데이터가 있으므로 2개와 2개의 조합에 의해 4개의 데이터가 표현된다.
- key
  - 두 데이터 프레임에서 이름이 같은 열은 모두 키가 될 수 있다.
  - 이름이 같아도 키가되면 안되는 열이 있으면 on 인수로 기준열을 명시해야 한다.
- 같은 이름의 열이 없는 경우
- 키가 되는 기준열이 두 데이터 프레임에서 다르게 나타나면 left_on,right_on 인수를 사용해서 기준열을 명시해야 함
- 일반 데이터 열이 아닌 인덱스를 기준으로 merge 할 수 도 있음
인덱스를 기준열로 사용하려면
  - left_index = True 또는
  - right_index = True 설정을 하게 됨
- 양쪽 데이터프레임에 key가 모두 인덱스 인 경우
  -  기준이 모두 index로 처리되어 있는 경우 index는 기존 index를 사용

- merge 명령어 대신 join 메서드를 사용가능
  - 사용 방법은 동일
#### concat 명령을 사용한 데이터 연결
```python
pd.concat(objs, # Series, DataFrame, Panel object 
 axis=0, # 0: 위+아래로 합치기, 1: 왼쪽+오른쪽으로 합치기 
 join='outer', # 'outer': 합집합(union), 'inner': 교집합(intersection) 
 ignore_index=False, # False: 기존 index 유지, True: 기존 index 무시 
 keys=None, # 계층적 index 사용하려면 keys 튜플 입력)
```
- concat 명령을 사용하면 기준열 없이 데이터를 연결한다.
- 기본은 위 아래로 데이터 행 결합(row bind) axis 속성을 1로 설정하면 열 결합(column bind)을 수행한다
- 단순히 두 시리즈나 데이터프레임을 연결하기 때문에 인덱스 값이 중복될 수 있다.

- concat() : 위 아래로 단순 병합

`result=pd.concat([df1, df2, df3],keys=['x','y','z']) `
- 인덱스가 중복될 때 멀티인덱스를 생성할 수도 있음
- join = 'inner' : 공통열만 표현
- ignore_index = True : 기존 인덱스 제거 후 제로베이스 인덱스 설정
- keys=[] : 상위레벨 인덱스 설정
- 다중 인덱스인 경우 데이터 접근 : .연산자를 이용한 체인 인덱싱

#### concate를 이용한 열 병합
- axis=1 설정
- pd.concat([df1,df2],axis=1,join='inner/outer')
- 데이터프레임들의 열을 결합한다
- 모든행을 표시하고 해당 행의 데이터가 없는 열의 원소는 NaN으로 표시된다 : 기본설정(join ='outer')
- 병합하는 데이터프레임에 중복되는 인덱스의 행만 표시한다 : join='inner'

- 행방향 결합(axis=0 생략 가능)
- df의 concat을 활용한 행 추가
#### 피봇테이블
- 가지고 있는 데이터원본을 원하는 형태의 가공된 정보를 보여주는 것
- 자료의 형태를 변경하기 위해 많이 사용하는 방법

- 방법 : 두개의 키를 사용해서 데이터를 선택
- pivot_table(data,values=None,index=None,columns=None,aggfunc='mean',margins=False,margins_name='All', observed=False, sort=True)
- data : 분석할 데이터 프레임. 메서드 형식일때는 필요하지 않음 ex)df1.pivot_table()
- values : 분석할 데이터 프레임에서 분석할 열
- index : 행 인덱스로 들어갈 키열 또는 키열의 리스트
- columns : 열 인덱스로 들어갈 키열 또는 키열의 리스트
- fill_value : NaN이 표출될 때 대체값 지정
- margins : 모든 데이터를 분석한 결과를 행으로 표출할 지 여부
- margins_name : margins가 표출될 때 그 열(행)의 이름

#### 피봇테이블을 작성할 때 반드시 설정해야 되는 인수
- data : 사용 데이터 프레임
- index : 행 인덱스로 사용할 필드(기준 필드로 작용됨)
- 인덱스 명을 제외한 나머지 값(data)은 수치 data 만 사용함
- 기본 함수가 평균(mean)함수 이기 때문에 각 데이터의 평균값이 반환
### 그룹 분석
- 만약 키가 지정하는 조건에 맞는 데이터가 하나 이상이라서 데이터 그룹을 이루는 경우에는 그룹의 특성을
보여주는 그룹분석(group analysis)을 해야 함
  - 그룹분석은 피봇테이블과 달리 키에 의해서 결정되는 데이터가 여러개가 있을 경우 미리 지정한 연산을 통해 그 그룹 데이터의 대표값을 계산 하는 것
- 판다스에서는 groupby 메서드를 사용하여 아래 내용 처럼 그룹분석을 진행
  - 분석하고자 하는 시리즈나 데이터프레임에 groupby 메서드를 호출하여 그룹화 수행
  - 그룹 객체에 대해 그룹연산을 수행
#### groupby 메서드
- groupby 메서드는 데이터를 그룹 별로 분류하는 역할을 함
- groupby 메서드의 인수
  - 열 또는 열의 리스트
  - 행 인덱스
- 연산 결과로 그룹 데이터를 나타내는 GroupBy 클래스 객체를 반환
  - 이 객체에는 그룹별로 연산을 할 수 있는 그룹연산 메서드가 있음

#### GroupBy 클래스 객체의 그룹연산 메서드
- size, count: 그룹 데이터의 갯수
- mean, median, min, max: 그룹 데이터의 평균, 중앙값, 최소, 최대
- sum, prod, std, var, quantile : 그룹 데이터의 합계, 곱, 표준편차, 분산, 사분위수
- first, last: 그룹 데이터 중 가장 첫번째 데이터와 가장 나중 데이터
#### 이 외에도 많이 사용되는 그룹 연산
- agg, aggregate
  - 만약 원하는 그룹연산이 없는 경우 함수를 만들고 이 함수를 agg에 전달한다.
  - 또는 여러가지 그룹연산을 동시에 하고 싶은 경우 함수 이름 문자열의 리스트를 전달한다.
- describe
  - 하나의 그룹 대표값이 아니라 여러개의 값을 데이터프레임으로 구한다.
- apply
  - describe 처럼 하나의 대표값이 아닌 데이터프레임을 출력하지만 원하는 그룹연산이 없는 경우에 사용한다.
- transform
  - 그룹에 대한 대표값을 만드는 것이 아니라 그룹별 계산을 통해 데이터 자체를 변형한다.
```python
# groups 속성을 확인하면 그룹핑된 요약을 볼 수 있음
groups.groups
# 딕셔너리 반환
# {그룹명 : 그룹에 포함된 행인덱스}
groups.groups.keys()
groups.groups['A']
# groupby 객체에 연산 메서드를 적용시켜 요약 결과를 확인
groups.sum()
```
### 그룹 함수 예제
- apply()/agg()
  - DF 등에 벡터라이징 연산을 적용하는 함수(axis = 0/1 이용하여 행/열 적용가능)
  - agg 함수는 숫자 타입의 스칼라만 리턴하는 함수를 적용 
   - apply의 특수한 경우 
  - 스칼라 : 하나의 수치(數値)만으로 완전히 표시되는 양. 방향의 구별이 없는 물리적 수량임.질량·에너지·밀도(密度)·전기량(電氣量) 따위.

# 그룹함수 및 피봇 테이블 이용 간단한 분석 예제
- 식당에서 식사 후 내는 팁(tip)과 관련된 데이터이용
- seaborn 패키지 내 tips 데이터셋 사용
  - total_bill: 식사대금
  - tip: 팁
  - sex: 성별
  - smoker: 흡연/금연 여부
  - day: 요일
  - time: 시간
  - size: 인원